 <div class="container chat-container p-0 ">
 
<div class="row w-100  m-0 p-0 h-100"> 
  <div *ngIf="chats.length>0" [ngClass]="{'showChatWindow':!showChatWindow,'hideShatWindow':showChatWindow}" class="chat-list col-md-4 col-12 h-100 shadow"   @zoomInOut>
    <div *ngFor="let chat of chats;trackBy:trackById" 
         class="chat-item"
         [class.active]="chat.docId === chatId"
       >
      
      <div  class="d-flex align-items-center"  (click)="selectChat(chat);showChatWindow=!showChatWindow">
        <img [src]="chat.userDetails[getOtherUserId(chat.users)]?.photoUrl"
        alt="avatar"
        class="avatar" />
   
   <div class="chat-item-info">
     <div class="name-time">
       <span class="name">
         {{ chat.userDetails[getOtherUserId(chat.users)]?.name }}
       </span>
       <span class="time">
         {{ chat.lastMessageTime?.toDate() | date:'HH:mm' }}
       </span>
       <span>
        <i (click)="deleteChat(chat.chatId)" class="fa-solid fa-trash text-danger"></i>
               </span>
     
     </div>
     <div class="last-message">
       {{ chat.lastMessage }}
     </div>

   </div>
 
      </div>
 
       <hr>
    </div>
  </div>

  <!-- نافذة المحادثة (يمين) -->
  <div *ngIf="user.id!=null" [ngClass]="{'showChatWindow':showChatWindow}" class="shadow chat-window col-md-8 col-12 p-0 bg-dark" style=" overflow: hidden !important; position: relative !important; " @zoomInOut>
    <!-- هيدر الشات -->
    <div class="  d-flex justify-content-between align-items-center col-12 w-100 mx-auto" style="position: sticky;top: 0; background-color: white;"  >
     
     <div class="chat-header w-100">
      <img [src]="user.img1" alt="avatar" *ngIf="user.id!=null" class="avatar" />
      <div class="header-info">
        <span class="name">{{ user.fullName }}</span>
      </div>
      
     </div>
   
     <div  class="p-3 d-md-none" (click)="showChatWindow=!showChatWindow">
      <i class="fa-solid fa-backward"></i>
     </div>
    </div>

    <!-- الرسائل -->
    <div class="messages" style="overflow-y: auto; height: 60dvh;" #chatContainer>
      <div *ngFor="let msg of messages;trackBy:trackById2"
           class="message"
           [ngClass]="{ sent: msg.senderId === myId, received: msg.senderId !== myId }">
        
        <span class="text">{{ msg.text }}</span>
        <span class="time" *ngIf="msg.timestamp">{{ msg.timestamp.toDate()| date:'HH:mm' }}</span>
      </div>
    </div>

    <!-- حقل الإرسال -->
    <div class="input-area">
      <input [(ngModel)]="message"   #messageInput
             type="text" 
             placeholder=" Write Message..."
             (keyup.enter)="sendMassage()" />
      <button (click)="sendMassage()" [disabled]="message==''||user.id==null" class="send-btn">
      
        <svg width="24" height="24" viewBox="0 0 24 24"><path fill="#007AFF" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/></svg>
      </button>
    </div>
  </div>
</div>
</div> 
